<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aletheia Demo Visualization</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; }
        .marker { display: inline-block; margin: 5px; padding: 5px; border-radius: 5px; }
        .HIGH { background-color: #ffcccc; }
        .LOW { background-color: #ccccff; }
        .NORMAL { background-color: #ccffcc; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .graph { margin: 20px 0; }
        .node { display: inline-block; margin: 10px; padding: 10px; border: 1px solid #000; border-radius: 5px; }
        .edge { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Aletheia Demo - Case Visualization</h1>

    <div id="content">
        <!-- Content will be loaded here -->
    </div>

    <script>
        // Hardcoded response for demo - in real app, fetch from API
        const response = {
            "normalized_labs": [
                {"marker": "Ferritin", "value": 220, "unit": "ng/mL", "status": "HIGH"},
                {"marker": "hsCRP", "value": 9.2, "unit": "mg/L", "status": "HIGH"},
                {"marker": "Iron", "value": 35, "unit": "µg/dL", "status": "LOW"},
                {"marker": "TSAT", "value": 12, "unit": "%", "status": "LOW"},
                {"marker": "Hb", "value": 11.2, "unit": "g/dL", "status": "LOW"},
                {"marker": "WBC", "value": 11.8, "unit": "K/µL", "status": "HIGH"},
                {"marker": "TSH", "value": 4.3, "unit": "mIU/L", "status": "HIGH"}
            ],
            "case_card": {
                "abnormal_markers": ["Ferritin", "hsCRP", "Iron", "TSAT", "Hb", "WBC", "TSH"],
                "signals": ["Iron deficiency pattern", "Thyroid dysfunction", "Inflammation pattern"],
                "patient_context": {"vegan": true, "fatigue": true}
            },
            "evidence_bundle": {
                "subgraph": {
                    "nodes": [
                        {"id": "p_inflam_iron_seq", "type": "Pattern", "label": "Inflammation-mediated iron sequestration"},
                        {"id": "c_anemia_inflam", "type": "Condition", "label": "Anemia of inflammation"},
                        {"id": "m_ferritin", "type": "Marker", "label": "Ferritin"},
                        {"id": "m_hscrp", "type": "Marker", "label": "High-Sensitivity C-Reactive Protein (hsCRP)"}
                    ],
                    "edges": [
                        {"id": "e_001", "from": "m_hscrp", "to": "p_inflam_iron_seq", "relation": "SUPPORTS"},
                        {"id": "e_002", "from": "p_inflam_iron_seq", "to": "m_ferritin", "relation": "INCREASES"}
                    ]
                },
                "supports": [{"claim": "Iron deficiency pattern is plausible"}],
                "allowed_claims": ["Possible iron deficiency pattern", "Recommend TSAT test", "Avoid iron supplementation as first-line if inflammation pattern present"]
            },
            "reasoner_output": {
                "diagnosis": "Anemia of Inflammation",
                "confidence": 0.8,
                "recommendations": ["Evaluate for inflammation sources", "Check ferritin trend"]
            },
            "guardrail_report": {"status": "PASS"}
        };

        function renderLabs(labs) {
            let html = '<h2>Normalized Labs</h2><div>';
            labs.forEach(lab => {
                html += `<span class="marker ${lab.status}">${lab.marker}: ${lab.value} ${lab.unit} (${lab.status})</span>`;
            });
            html += '</div>';
            return html;
        }

        function renderCaseCard(card) {
            let html = '<h2>Case Card</h2>';
            html += '<p><strong>Abnormal Markers:</strong> ' + card.abnormal_markers.join(', ') + '</p>';
            html += '<p><strong>Signals:</strong> ' + card.signals.join(', ') + '</p>';
            html += '<p><strong>Patient Context:</strong> Vegan: ' + card.patient_context.vegan + ', Fatigue: ' + card.patient_context.fatigue + '</p>';
            return html;
        }

        function renderEvidence(evidence) {
            let html = '<h2>Evidence Bundle</h2>';
            html += '<h3>Knowledge Graph Subgraph</h3>';
            html += '<div class="graph">';
            evidence.subgraph.nodes.forEach(node => {
                html += `<div class="node">${node.label} (${node.type})</div>`;
            });
            html += '</div>';
            html += '<h3>Edges</h3>';
            evidence.subgraph.edges.forEach(edge => {
                html += `<div class="edge">${edge.from} --${edge.relation}--> ${edge.to}</div>`;
            });
            html += '<h3>Supports</h3><ul>';
            evidence.supports.forEach(s => {
                html += `<li>${s.claim}</li>`;
            });
            html += '</ul>';
            html += '<h3>Allowed Claims</h3><ul>';
            evidence.allowed_claims.forEach(c => {
                html += `<li>${c}</li>`;
            });
            html += '</ul>';
            return html;
        }

        function renderReasoner(output) {
            let html = '<h2>Reasoner Output</h2>';
            html += `<p><strong>Diagnosis:</strong> ${output.diagnosis}</p>`;
            html += `<p><strong>Confidence:</strong> ${output.confidence}</p>`;
            html += '<p><strong>Recommendations:</strong></p><ul>';
            output.recommendations.forEach(r => {
                html += `<li>${r}</li>`;
            });
            html += '</ul>';
            return html;
        }

        function renderGuardrails(report) {
            return `<h2>Guardrails</h2><p>Status: ${report.status}</p>`;
        }

        document.getElementById('content').innerHTML =
            renderLabs(response.normalized_labs) +
            renderCaseCard(response.case_card) +
            renderEvidence(response.evidence_bundle) +
            renderReasoner(response.reasoner_output) +
            renderGuardrails(response.guardrail_report);
    </script>
</body>
</html></content>
</xai:function_call">To visualize the case results, I've created a simple HTML page that displays the key components: normalized labs with color-coded statuses, case card summary, knowledge graph subgraph, evidence supports, reasoner diagnosis and recommendations, and guardrail status. Open `index.html` in a browser to view the visualization.